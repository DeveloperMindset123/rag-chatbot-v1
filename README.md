# RAG Chatbot with ChromaDB

A Retrieval-Augmented Generation (RAG) chatbot backend that uses ChromaDB for vector storage, built with Model Context Protocol (MCP).

## Overview

This project implements a RAG chatbot with the following components:

- ChromaDB HTTP client for vector database storage (running on localhost:9000)
- FastAPI backend service with asynccontextmanager for synchronizing async and sync tasks
- Model Context Protocol (MCP) for structured conversations
- CLI client for terminal-based testing

The architecture allows for efficient retrieval of relevant information from a knowledge base to enhance the quality of generated responses.

## Prerequisites

- Python 3.9+
- Git
- Terminal/Command Line access
- `uv` (recommended) or `pip` package manager

## Installation

1. Clone the repository:

   ```bash
   git clone https://github.com/DeveloperMindset123/rag-chatbot-v1.git
   cd rag-chatbot-v1
   ```

2. Set up a virtual environment with `uv` (recommended for faster performance):

   ```bash
   # Install uv if not already installed
   # pip install uv

   # Create virtual environment
   uv venv venv

   # On Windows
   venv\Scripts\activate

   # On macOS/Linux
   source venv/bin/activate
   ```

3. Install dependencies:

   ```bash
   # Using uv (recommended)
   uv pip install -r requirements.txt

   # Or using pip
   pip install -r requirements.txt
   ```

## Configuration

1. Create a `.env` file in the root directory with the following variables:

   ```
   ANTHROPIC_API_KEY=ANTRHOPIC_API_KEY_HERE
   GEMINI_API_KEY=GEMINI_API_KEY_HERE
   OPENAI_API_KEY=OPENAI_API_KEY_HERE
   ```

2. Modify the configuration parameters as needed for your environment.

## Running ChromaDB

Start the ChromaDB HTTP server:

```bash
# Terminal 1
chroma run --path /path/to/your/chromaDbData --port 9000 --host localhost
```

Replace `/path/to/your/chromaDbData` with the absolute path where you want your vector data to be stored. You can also modify the port and host settings as needed.

## Running the MCP Server and Client

### Step 1: Configure the MCP Server Path

1. Open the `mcp_client.py` file
2. Locate the section where you connect to the server
3. Replace the server script path with the absolute path to where your server code is located

### Step 2: Start the FastAPI Server

```bash
# Terminal 2
cd rag-backend
uv run uvicorn main:app --reload
```

Take a look at the frontend code which is interacting with this terminal instance : [Frontend Repository](https://github.com/DeveloperMindset123/rag-chatbot-v1-frontend)

### Step 3: Testing with the CLI Client

The repository includes a terminal-based client for testing:

```bash
# Terminal 3
python cli_chatbot_client.py
```

This will open an interactive console where you can test the chatbot directly.

## Project Structure

```
rag-chatbot-v1/
├── rag-backend/             # Directory where all code is stored
    ├── cli_chatbot_client.py    # Terminal-based client for testing
    ├── chromaDB.py          # executable script to push data to vector database
    ├── mcp_client.py        # Actual MCP client that interacts with server.py
    ├── mcp_client_log.log   # Log file to store information to help with debugging.
    ├── mcp-test-client.py   # Simple Executable script to check if mcp client is able to access server and corresponding tools.
    ├── server.py            # Code regarding actual mcp-server.
    ├── main.py              # FastAPI endpoint that connects to mcp_client.py
... other files related to configurations and storage and autogenerated
└── test.rest                # Used to test api endpoints implemented within main.py
└── .env.example             # Example environment variables file
```

## MCP Server Implementation

The MCP Server (`server.py`) provides the following tools and functionality:

- `echo`: A simple echo tool for testing
- `context_retriever`: Searches ChromaDB to retrieve relevant context
- `peek_at_database`: Retrieves top-level data from collections
- `modify_collection_name`: Allows renaming collections
- `get_list_of_collections`: Lists all available collections
- `delete_collection_by_name`: Deletes a collection
- `enter_data`: Enters fresh data into a new collection
- `get_collection_data_count`: Returns the count of data in a collection
- `get_user_query_history`: Retrieves user query history from contextual_data collection
- `count_claude_message_tokens`: Counts tokens used in current query

## MCP Client Implementation

The MCP Client (`mcp_client.py`) handles:

- Connection to the MCP server
- Management of sessions using AsyncExitStack
- Tool execution
- LLM integration with Anthropic Claude and Google Gemini
- Conversation logging
- Context history management using ChromaDB

## Advanced Configuration

### Customizing ChromaDB

You can modify the ChromaDB settings in `chromaDB/client.py` to adjust:

- Collection settings
- Metadata filtering
- Distance metrics

### Adjusting the MCP Client

The MCP client uses `asynccontextmanager` via AsyncExitStack to handle both synchronous and asynchronous operations. You can customize the behavior in `mcp_client.py`.

## LLM Models Support

This project currently supports two LLM models:

- Anthropic Claude (default)
- Google Gemini

The model selection can be changed via the client interface or by modifying the `model_choice` variable in the MCPClient class.

## Troubleshooting

### ChromaDB Connection Issues

If you encounter connection issues with ChromaDB:

1. Ensure ChromaDB is running with the correct path:
   ```bash
   chroma run --path /path/to/your/chromaDbData --port 9000 --host localhost
   ```
2. Check if the port is accessible:
   ```bash
   curl http://localhost:9000/api/v2/heartbeat
   ```
3. Verify the correct ChromaDB client configuration in your code

### MCP Client/Server Synchronization

If you encounter issues with the MCP client/server synchronization:

1. Check the logs in `mcp_client_log.log`
2. Ensure both client and server are using compatible MCP versions
3. Verify the server path in the client is correct
4. Check that the FastAPI server is properly handling asyncio context

### API Key Issues

If you encounter authentication errors:

1. Verify that all required API keys are correctly set in the `.env` file
2. Ensure the environment variables are being loaded properly
3. Check for any rate limiting or quota issues with the respective API providers

## Development Tips

1. Use the CLI client for quick testing of new features.
2. Monitor the ChromaDB collection growth with the `peek_at_database` tool.
3. Use the `get_user_query_history` tool to debug conversation context issues.
4. Check the json files generated each step within `conversations` directory for debugging.

## Contributing

1. Fork the repository
2. Create a feature branch: `git checkout -b feature-name`
3. Commit changes: `git commit -am 'Add new feature'`
4. Push to the branch: `git push origin feature-name`
5. Submit a pull request

## License

MIT License

## Contact

[dasa60196@gmail.com]
